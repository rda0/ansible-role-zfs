- name: include role apt for buster
  include_role:
    name: apt
  when: ansible_distribution_release == 'buster'

- name: check for backports
  fail:
    msg: 'Enable backports in apt role'
  when: ansible_distribution_release == 'buster' and not _zfs_apt_include_backports

- name: configure backports
  template:
    src: apt-prefs.j2
    dest: /etc/apt/preferences.d/90_zfs
    owner: root
    group: root
    mode: 0644
  notify: apt update
  when: ansible_distribution_release == 'buster'

- name: install zfs-dkms build dependencies debian
  package:
    pkg:
      - dpkg-dev
      - linux-headers-amd64
      - linux-image-amd64
  when: ansible_distribution|lower == 'debian'

- name: install zfs-dkms debian
  package:
    pkg: zfs-dkms
  when: ansible_distribution|lower == 'debian'

- name: install zfs
  package:
    pkg: zfsutils-linux
